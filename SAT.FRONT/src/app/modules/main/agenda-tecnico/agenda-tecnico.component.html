<mat-drawer-container class="main-agenda" [hasBackdrop]="false">

    <mat-drawer class="lg:w-120 md:w-80 dark:bg-gray-900" [position]="'end'" #sidenav>
        <app-agenda-tecnico-filtro [sidenav]="sidenav"></app-agenda-tecnico-filtro>
    </mat-drawer>

    <mat-drawer class="lg:w-120 md:w-80 dark:bg-gray-900 z-in" [position]="'end'" #sidenavChamados>
        <app-agenda-tecnico-chamados [sidenavOut]="sidenavChamados"></app-agenda-tecnico-chamados>
    </mat-drawer>

    <mat-drawer class="lg:w-120 md:w-80 dark:bg-gray-900" [position]="'end'" #sidenavAjuda>
        <app-agenda-tecnico-ajuda [sidenav]="sidenavAjuda">
        </app-agenda-tecnico-ajuda>
    </mat-drawer>

    <div class="scheduler-scroll">
        <mbsc-eventcalendar [options]="calendarOptions" [data]="events" [resources]="resources"
            [resourceTemplate]="resourceTemplate" [scheduleEventTemplate]="eventTemplate" *ngIf="!loading &&
            resources?.length != 0">
        </mbsc-eventcalendar>
        <button class="add-button" (click)="sidenavChamados.toggle()" [disabled]="loading" [matTooltip]="'Chamados'">
            <mat-icon [svgIcon]="'heroicons_outline:plus'" class="text-white"></mat-icon>
        </button>

        <button class="filter-button bg-gray-800" (click)="sidenav.toggle()" [matTooltip]="'Filtro'">
            <mat-icon [svgIcon]="'heroicons_outline:filter'" class="text-white"></mat-icon>
        </button>

        <button class="help-button bg-gray-400" (click)="showHelp()" [disabled]=" loading" [matTooltip]="'Ajuda'">
            <mat-icon [svgIcon]="'heroicons_outline:question-mark-circle'" class="text-white"></mat-icon>
        </button>

        <div class="loading-indicator" *ngIf="loading">
            <mat-spinner diameter="50"></mat-spinner>
        </div>

        <div class="font-bold p-6" *ngIf="!loading && resources?.length == 0">
            Nenhum técnico encontrado. Por favor, verifique seus filtros.
        </div>

        <mbsc-popup class="md-tooltip" #popup [anchor]="anchor" [options]="popupOptions">
            <div class="text-center p-2" (mouseenter)="mouseEnter()" (mouseleave)="mouseLeave()">
                <div class="md-tooltip-header">
                    <span class="md-tooltip-name-age font-bold">{{ info }}</span>
                    <br>
                    <span class="md-tooltip-time font-bold">{{ time }}</span>

                    <span class="md-tooltip-status md-tooltip-text font-bold"
                        *ngIf="selectResource">{{ selectResource?.contato | fone }}</span>
                    <br>
                    <span class="md-tooltip-status md-tooltip-text"
                        *ngIf="selectResource">{{ selectResource?.descricao }}</span>
                </div>

                <div class="md-tooltip-info">
                    <div class="md-tooltip-title">
                        <span class="md-tooltip-status md-tooltip-text">{{ intervencao }}</span>
                        <br>
                        <span class="md-tooltip-status md-tooltip-text font-bold">{{ status }}</span>
                        <!-- <br>
                        <span class="md-tooltip-status md-tooltip-text font-bold" *ngIf="dataHoraLimiteAtendimento">
                            {{ dataHoraLimiteAtendimento | date:'dd/MM HH:mm') }}
                        </span> -->
                    </div>
                </div>
            </div>
        </mbsc-popup>

        <ng-template #resourceTemplate let-resource>
            <div class="inline-flex" [ngClass]="{'text-gray-400': resource.indFerias}">
                <img class="md-meeting-participant-avatar" [src]="resource.img"
                    onError="this.src='./assets/images/avatars/profile.jpg';"
                    [ngClass]="{'opacity-10': resource.indFerias}" (mouseover)="showResourceAction(resource)"
                    (mouseleave)="hideEventInfo()" />
                <div class="md-resource-details-name truncate" [innerHTML]="resource.name"
                    [matTooltip]="resource.indFerias ? 'EM FÉRIAS' : ''">
                </div>
                <div class="grid grid-rows-1 grid-cols-3 grid-flow-col" *ngIf="!resource.indFerias">
                    <div>
                        <div class="mr-1 ml-1 bg-yellow-400 text-black py-1 px-2 rounded text-xs font-bold text-center
                        align-middle mbsc-counter" [matTooltip]="'Técnico não possui ponto registrado hoje.'"
                            *ngIf="countPontoEvents(resource) == 0">
                            {{ "!" }}
                        </div>
                    </div>
                    <div class="mr-1 ml-1 bg-green-700 text-black py-1 px-2 rounded text-xs font-bold text-center
                        align-middle mbsc-counter" [matTooltip]="'Chamados atendidos'">
                        {{ countResourceAtendidos(resource) }}
                    </div>
                    <div class="mr-1 ml-1 bg-red-300 text-black py-1 px-2 rounded text-xs font-bold text-center
                        align-middle mbsc-counter" [matTooltip]="'Chamados transferidos'">
                        {{ countResourceTransferidos(resource) }}
                    </div>
                </div>
            </div>
        </ng-template>

        <ng-template #eventTemplate let-data>
            <div class="mbsc-ios mbsc-schedule-event-background mbsc-timeline-event-background overflow-hidden"
                [ngStyle]="{borderColor: data.color, background: data.title == 'PONTO' || data.title == 'FIM DO EXPEDIENTE' ?
                'transparent' : data.color}">
                <span class="mbsc-icon mbsc-font-icon mbsc-icon-clock"
                    [ngStyle]="{color: data.title == 'FIM DO EXPEDIENTE' ? 'red' : 'green', background: 'transparent'}"
                    *ngIf="data.title == 'PONTO' || data.title == 'FIM DO EXPEDIENTE'"></span>
                <div class="mbsc-custom-event-title"
                    [ngStyle]="{ color: data.title == 'INTERVALO' ? 'black' : 'white'}">
                    {{ data.title }}
                </div>
            </div>
        </ng-template>
    </div>

</mat-drawer-container>